@using System.Dynamic
@using Newtonsoft.Json
@using OnyxScoutApplication.Client.Others.Objects.Analyzers.TeamData
@inherits TeamsAnalyzer
<div>
    @if (CalculatedTeamsData != null)
    {
        <SfGrid @ref="@dataGrid" AllowTextWrap="true" DataSource="@CalculatedTeamsData" AllowReordering="true" 
                 AllowFiltering="true" AllowResizing="true" AllowSorting="true" AllowMultiSorting="true"
                 Toolbar="@toolbarItems" ShowColumnChooser="true" Width="100%">
            <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Menu"></GridFilterSettings>
            <GridColumns>
                <GridColumn HeaderText="Team" Field="TeamNumber" AllowFiltering="true"
                            FilterSettings="@(new FilterSettings {Type = Syncfusion.Blazor.Grids.FilterType.CheckBox})"
                            Width="100px">
                    <Template>
                        @{
                            var v = (dynamic) context;
                            <div>
                                <span class="clickable"
                                      @onclick="() => OnTeamGridClicked(v.TeamNumber)">
                                    @(v.Nickname)
                                </span>
                            </div>
                            <div>
                                <span class="clickable"
                                      @onclick="() => OnTeamGridClicked(v.TeamNumber)">
                                    @(v.TeamNumber)
                                </span>
                            </div>
                        }
                    </Template>
                </GridColumn>
                @for (int i = 0; i < ColumnsFields.Count; i++)
                {
                    int index = i;
                    string nameId = ColumnsFields[index].NameId;
                    string name = ColumnsFields[index].Name;
                    string rawValue = "RawValue" + nameId;
                    <GridColumn HeaderText="@name" Field="@rawValue" AutoFit="true" AllowReordering="true"
                                AllowResizing="true" Type="ColumnType.Number">
                        <HeaderTemplate>
                            <div>
                                <span>@ColumnsFields[index].MarkupName</span>
                            </div>
                        </HeaderTemplate>
                        <Template>
                            @{
                                var v = (IDictionary<string, object>) context;
                                var s = new MarkupString(v[nameId].ToString());
                            }
                            <span>@s</span>
                        </Template>
                    </GridColumn>
                }
            </GridColumns>
        </SfGrid>
    }
</div>

@code {

    [Parameter]
    public EventCallback<int> OnTeamClicked { get; set; }

    private string[] toolbarItems = {"ColumnChooser"};
    private SfGrid<ExpandoObject> dataGrid;
    private string width;

    private async Task OnTeamGridClicked(int teamNumber)
    {
        await OnTeamClicked.InvokeAsync(teamNumber);
    }

    private class TeamAverage
    {
        public Team Team { get; set; }
        public List<TeamFieldAverage> TeamFieldAverage { get; set; }
    }

}

<style>
    .clickable {
        cursor: pointer
    }
</style>
